Техническая документация: Pocket-game_bot
1. Общее описание
Данный проект представляет собой Telegram-бота для игры в "Города". Бот поддерживает:

Игру по стандартным правилам "Городов"

Возможность перезапуска игры

Проверку корректности вводимых городов

Автоматический выбор города ботом в ответ на ход пользователя

2. Архитектура системы
Проект состоит из двух основных модулей:

main.py - основной модуль бота (Telegram-интерфейс)

cities_game.py - игровая логика

2.1. Модуль main.py
Основные компоненты:
TeleBot - основной объект бота

Обработчики сообщений:

/start - начало работы с ботом

Текстовые сообщения (обработка ходов в игре)

Система состояний:

cities_branch - флаг активности игры в города

sudoku_branch - флаг активности игры в судоку (не реализовано)

bot_says - последний названный ботом город

flag_0 - флаг активности текущей игры

Ключевые функции:
last_char_search() - поиск последней допустимой буквы в названии города

choose_game() - выбор типа игры

cities_start() - инициализация новой игры в города

cities_game() - основная игровая логика

2.2. Модуль cities_game.py
Основные компоненты:
cities_list - список всех городов России

unnamed_cities - список еще не названных городов в текущей игре

Ключевые функции:
cities_loop() - основная игровая логика, проверка ходов

choose_random_city() - выбор случайного города для хода бота

new_game() - инициализация новой игры

3. Детальное описание функций
3.1. Функция last_char_search(word: str) -> str
Назначение: Находит последнюю допустимую букву в названии города (исключая ё, ы, ъ, ь)

Параметры:

word - название города

Возвращает:

Последнюю допустимую букву

Логика работы:

Удаляет последнюю букву, если она входит в список исключений

Возвращает последнюю оставшуюся букву

3.2. Функция cities_loop(city: str, last_char: str, f: bool) -> str
Назначение: Проверяет корректность хода и определяет состояние игры

Параметры:

city - город, названный пользователем

last_char - последняя буква предыдущего города

f - флаг активности игры

Возвращаемые значения:

game over - игра завершена

not city - введено не название города

repeat - город уже был назван

wrong input - город начинается не с нужной буквы

totally won - все города названы (победа)

won by bot - не осталось городов на нужную букву (победа бота)

ok - ход корректен

Логика работы:

Проверяет активность игры

Проверяет, является ли ввод названием города

Проверяет, не был ли город назван ранее

Проверяет соответствие первой буквы

Проверяет условия завершения игры

Удаляет город из списка доступных при успешной проверке

3.3. Функция choose_random_city(last_char: str) -> str
Назначение: Выбирает случайный город для хода бота

Параметры:

last_char - буква, с которой должен начинаться город

Возвращает:

Название города или bot lose, если подходящих городов нет

Логика работы:

Формирует список городов на нужную букву

Выбирает случайный город из списка

Удаляет выбранный город из общего списка

4. Потоки данных
4.1. Запуск новой игры
Пользователь отправляет /start

Бот предлагает выбрать игру

При выборе "города":

Инициализируется новый список городов (new_game())

Устанавливаются начальные флаги (cities_start())

4.2. Ход в игре
Пользователь отправляет название города

Бот проверяет ход (cities_loop())

При успешной проверке:

Бот выбирает ответный город (choose_random_city())

Отправляет город пользователю

При ошибке - отправляет соответствующее сообщение
